---
title: "Visualizations"
author: "LeTicia Cancel"
date: "11/25/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## libraries
```{r message=FALSE,warning=FALSE}
library(quanteda)
library(tm)
library(SnowballC)
library(wordcloud)
library(tidytext)
library(r2d3)
```

## wordcloud testing

https://www.rdocumentation.org/packages/tm/versions/0.7-8/topics/Corpus 

```{r warning=FALSE,message=FALSE}
#fake
fake_output_df <- output_df %>%
  filter(DocType == "Fake") %>%
  select(-c(docId,DocType,the))


#fake
v = sort(colSums(fake_output_df),decreasing = TRUE)
myNames = names(v)
d = data.frame(word=myNames,freq=v)
wordcloud(d$word, colors=c(3,4),random.color=FALSE,d$freq,min.freq=60)

#true
true_output_df <- output_df %>%
  filter(DocType == "True") %>%
  select(-c(docId,DocType,the))

#true
v2 = sort(colSums(true_output_df),decreasing = TRUE)
myNames2 = names(v2)
d2 = data.frame(word=myNames2,freq=v2)
wordcloud(d2$word, colors=c(3,4),random.color=FALSE,d2$freq,min.freq=60)
```


create df of true and fake words and export .tsv file to use with r2d3 script
```{r warning=FALSE,message=FALSE}
#head(true_df)

#convert text column from factor to character 
true_df <- mutate(true_df, text = as.character(true_df$text))

#total count of words in true df
true_df_words <- true_df %>%
  unnest_tokens(word,text) %>%
  anti_join(get_stopwords()) %>%
  count(type, word, sort = TRUE)

#top 20 true words df
top_true_df_words <- true_df_words %>%
  #select(-c(type)) %>%
  filter(!word %in% c("s","창")) %>%
  top_n(20, n)

#create .tsv file to use in r2d3 testing
con<-file(here('model_scripts','data.tsv'),encoding="UTF-8")
write.table(top_true_df_words,file=con , row.names = FALSE, sep = "\t")

#head(fake_df)

#convert text column from factor to character 
fake_df <- mutate(fake_df, text = as.character(fake_df$text))

#total count of words in fake df
fake_df_words <- fake_df %>%
  unnest_tokens(word,text) %>%
  anti_join(get_stopwords()) %>%
  count(type, word, sort = TRUE)

#top 20 fake words df
top_fake_df_words <- fake_df_words %>%
  #select(-c(type)) %>%
  filter(!word %in% c("s","창","t")) %>%
  top_n(20, n)
```

## r2d3 testing

Top 20 words from True DF

- script can be modified or duplicated to display chart for other datasets.

- a .tsv file is not needed. we can just feed it data frames and it will display 

- chart title is hard coded

## working r2d3 chart to use as reference only 

## shiny app testing


## create df to use with shiny app
```{r warning=FALSE,message=FALSE}
top_words_all <- fake_df_words %>%
  filter(!word %in% c("s","창","t")) %>%
  top_n(20, n)

x <- true_df_words %>%
  filter(!word %in% c("s","창","t")) %>%
  top_n(20, n)

#top 20 real and fake news words df to use in shiny app
top_words_all <- rbind(top_words_all,x)

```


## shiny app Works!!!!!

shiny using ggplot
```{r message=FALSE, warning=FALSE}
library(shiny)
library(datasets)
library(tidyr)

ui <- fluidPage(
  titlePanel("Top 20 Words"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("type", "Type of Article:",
                  choices = top_words_all$type,
                  selected = c(top_words_all$type == "Fake")),
      hr(),
      helpText("Select a type from the dropdown to display data")
    ),
    
    mainPanel(
      plotOutput("typePlot")
    )
  )
)

server <- function(input, output){
  output$typePlot <- renderPlot({
    
    #render a plot
    top_words_all %>%
      filter(type == input$type) %>%
      ggplot(aes(word,n)) +
      geom_col() +
      ylab("Word Count") +
      coord_flip() 
#    barplot(top_words_all[input$n, input$word],
#            main = input$word,
#            ylab = "Number of Telephones",
#            xlab = "Year")
  })
}

shinyApp(ui = ui, server = server)
```



shiny using d3
```{r warning=FALSE,message=FALSE}
library(shiny)
library(datasets)
library(tidyr)

ui <- fluidPage(
  titlePanel(tags$strong("Top 20 Words")),
  
  verticalLayout(
    tags$h3("Fake News Words"),
    d3Output("fake"),
    tags$h3("True News Words"),
    d3Output("real")
  )
  
)

server <- function(input, output){
  output$fake <- renderD3(r2d3::r2d3(data=top_fake_df_words, script = "r2d3/d3_scripts.js", d3_version = "3", container = "div"))
  output$real <- renderD3(r2d3::r2d3(data=top_true_df_words, script = "r2d3/d3_scripts.js", d3_version = "3", container = "div"))

}


shinyApp(ui,server)
```


visuals for a sentiment analysis

```{r warning=FALSE,message=FALSE}
library(reshape2)

head(fake_df)
head(true_df) 

fake_df <- mutate(fake_df, text = as.character(fake_df$text))

full_df <- mutate(full_df, text = as.character(full_df$text))

true_df_words <- true_df %>%
  unnest_tokens(word,text) %>%
  anti_join(get_stopwords())

fake_df_words <- fake_df %>%
  unnest_tokens(word,text) %>%
  anti_join(get_stopwords())

# top 50 words in word cloud
fake_df_words %>%
  #select(word, type) %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(colors = c("gray10", "gray50"),
                   max.words = 300)


# top 50 words in word cloud
true_df_words %>%
  #select(word, type) %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(colors = c("gray10", "gray50"),
                   max.words = 300)


fake_df_words_top <- fake_df_words %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment) %>%
  top_n(10,n) %>%
  arrange(desc(n))

# table of top 20 words
knitr::kable(fake_df_words_top)

true_df_words_top <- true_df_words %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment) %>%
  top_n(10, n) %>%
  arrange(desc(n))

# table of top 20 words
knitr::kable(true_df_words_top)
```











## to archive

shiny app and d3 mixed - overlaps
```{r warning=FALSE,message=FALSE}
library(shiny)
library(datasets)
library(tidyr)

ui <- fluidPage(
  titlePanel("Top 20 Words"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("type", "Type of Article:",
                  choices = top_words_all$type),
                 # selected = c(top_words_all$type == "Fake")),
      hr(),
      helpText("Select a type from the dropdown to display data")
    ),
    
    d3Output("d3")
  )
)

server <- function(input, output){
  output$d3 <- renderD3({
    #render d3 graph
    if(input$type == "Fake"){
      r2d3::r2d3(data=top_fake_df_words, script = "r2d3/d3_scripts.js", d3_version = "3", container = "div")
    }
    else{
      r2d3::r2d3(data=top_true_df_words, script = "r2d3/d3_scripts.js", d3_version = "3", container = "div")
    }
  })
  #output$d3.exit().remove()

}


shinyApp(ui,server)
```


create dataset 
```{r warning=FALSE,message=FALSE}
dataset_test <- readr::read_tsv("r2d3/data_testing.tsv")
```

```{r warning=FALSE,message=FALSE}
r2d3::r2d3(data=dataset_test, script = "r2d3/d3_scripts_copy.js", d3_version = "3", container = "div")
?r2d3

all_50 <- rbind(fake_df_words, true_df_words)

all_50 %>%
  #select(word, type) %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(colors = c("tomato3", "steelblue1"),
                   max.words = 300)

layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE)) 
fake_wc
true_wc
all_wc
```
